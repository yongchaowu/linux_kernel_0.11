## 一、总体功能介绍

这是关于`Linux-kernel-0.11`中boot文件夹下`setup.s`源文件的实现功能的总结说明。

  setup.s是一个操作系统加载程序，它的主要功能是利用BIOS中断读取机器系统数据，并将这些数据保存到0x90000开始的位置(覆盖了原先的bootsect.s程序)，所取得的参数和保存在内存中的位置如下所示，这些参数将被内核中相关程序使用，如字符设备驱动程序集中的console.c和tty_io.c 程序等。

- setup.s程序读取并保存的参数:
![](https://images2018.cnblogs.com/blog/825979/201805/825979-20180524200817644-206513817.png)

然后 setup 程序将system模块从0x10000-0x8ffff处(当时认为系统内核米块system的长度不会超过512KB)整块向下移动到内存绝对地址0x00000处。 接下来加载中断描述符表寄存器（idtr）和全局描述符表(gdtr),开启A20地址线，重新设置两个中断控制器8259A，将硬件中断号重新设置为0x20-0下f。 最后设置CPU的控制寄存器CR0（也称机器状态字），从而进入32位保护模式下运行，并跳转到位于system模块最前面部分的head.s程序继续执行。

为了能让head.s在32位保护模式下运行，在本程序中临时设置了中断描述符表（IDT）和全局描述符表（GDT），并在GDT中设置了当前内核代码段的描述符和数据段的描述符，在head.s程序中会根据需要重新设置这些描述符表。

有关段描述符表的内容可以参考 [操作系统分段机制。](https://www.cnblogs.com/ay-a/p/8338377.html)


## 二、代码注释

```asm



```